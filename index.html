<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #ffffff; }
    h1 { margin-bottom: 10px; }

    .notice-box {
      background: #f7f7f7;
      border: 1px solid #ddd;
      padding: 10px 14px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.7;
    }

    .top-area { margin-bottom: 15px; }
    .form-area { margin-bottom: 20px; }

    select, input, button { padding: 6px; margin-right: 6px; font-size: 14px; }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 14px; }
    th { background: #f2f2f2; }

    button { cursor: pointer; }
    button:disabled { opacity: 0.5; }

    .reset-btn { background: #eee; }

    .overlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000;
    }

    .guide-box {
      background: #fff;
      padding: 20px;
      width: 420px;
      border-radius: 6px;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="guideOverlay" class="overlay">
  <div class="guide-box">
    <p>
      ğŸ“Œ <b>í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€ ì•ˆë‚´</b><br><br>
      1. ë¬¼í’ˆ ì„ íƒ í›„ ì´ë¦„Â·í•™ë²ˆ ì…ë ¥ â†’ <b>[ëŒ€ì—¬í•˜ê¸°]</b><br>
      2. ë°˜ë‚©ì€ <b>í•™ìƒíšŒ ë‹´ë‹¹ì í™•ì¸ í›„</b> ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
      3. ë¬¼í’ˆ ëŒ€ì—¬ëŠ” ìš´ì˜ ì‹œê°„ì¸ <b>10ì‹œ~18ì‹œ</b> ë‚´ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br>
      âœ… <b>ì¼íšŒìš©í’ˆì€ ì¥ë¶€ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.</b>
    </p>
    <button id="closeGuideBtn">í™•ì¸</button>
  </div>
</div>

<h1>í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€</h1>

<div class="notice-box">
  <div>âœ” ë¬¼í’ˆ ëŒ€ì—¬ëŠ” ìš´ì˜ ì‹œê°„ì¸ <b>10ì‹œ~18ì‹œ</b> ë‚´ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
  <div>âœ” ë¬¼í’ˆ ë°˜ë‚© ë˜í•œ <b>ëŒ€ì—¬ ë‹¹ì¼ ìš´ì˜ ì‹œê°„ ë‚´</b>ì— ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div>
  <div>âœ” ë°˜ë‚©ì€ <b>í•™ìƒíšŒ ë‹´ë‹¹ìì˜ í™•ì¸</b>ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
</div>

<div class="top-area">
  <button class="reset-btn" id="resetBtn">ì´ˆê¸°í™” (ìƒˆ ì¥ë¶€)</button>
</div>

<div class="form-area">
  <select id="itemSelect"></select>
  <select id="itemNoSelect"></select>
  <input id="nameInput" placeholder="ì´ë¦„">
  <input id="studentIdInput" placeholder="í•™ë²ˆ">
  <button id="rentBtn">ëŒ€ì—¬í•˜ê¸°</button>
</div>

<table>
  <thead>
    <tr>
      <th>ë²ˆí˜¸</th><th>ë¬¼í’ˆ</th><th>ë¬¼í’ˆë²ˆí˜¸</th><th>ì´ë¦„</th><th>í•™ë²ˆ</th>
      <th>ëŒ€ì—¬ ì‹œê°</th><th>ë°˜ë‚© ì‹œê°</th><th>ë°˜ë‚©</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
const ADMIN_PASSWORD = "ì •ì°¬";
const STORAGE_KEY = "rentalRecords_local_v2";

function nowKoreanString() {
  return new Date().toLocaleString("ko-KR");
}

// ===== ë¬¼í’ˆ ì„¤ì • =====
const ITEM_CONFIG = {
  "ì‹¤í—˜ë³µ": 15,
  "ê³„ì‚°ê¸°": 8,
  "í™”ì´íŠ¸": 4,
  "ì": 3,
  "í’€": 2,
  "ì»´í“¨í„°ì‚¬ì¸íœ": 0 // ë¬´í•œ ëŒ€ì—¬
};

const activeRentedKeys = new Set();
function makeKey(item, no) { return `${item}::${no}`; }

function loadRecords() {
  const raw = localStorage.getItem(STORAGE_KEY);
  return raw ? JSON.parse(raw) : [];
}
function saveRecords(r) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(r));
}

let records = loadRecords();

// ===== UI =====
const itemSelect = document.getElementById("itemSelect");
const itemNoSelect = document.getElementById("itemNoSelect");
const nameInput = document.getElementById("nameInput");
const studentIdInput = document.getElementById("studentIdInput");
const tableBody = document.getElementById("tableBody");

function initItemSelect() {
  itemSelect.innerHTML = "";
  Object.keys(ITEM_CONFIG).forEach(item => {
    const opt = document.createElement("option");
    opt.value = item;
    opt.textContent = item;
    itemSelect.appendChild(opt);
  });
}

function rebuildActive() {
  activeRentedKeys.clear();
  records.forEach(r => {
    if (!r.returnTime && r.itemNo) {
      activeRentedKeys.add(makeKey(r.item, r.itemNo));
    }
  });
}

function updateItemNoOptions() {
  const item = itemSelect.value;
  const count = ITEM_CONFIG[item];

  itemNoSelect.innerHTML = "";

  if (count === 0) {
    const opt = document.createElement("option");
    opt.value = "âˆ";
    opt.textContent = "(ëŒ€ì—¬ ê°€ëŠ¥)";
    itemNoSelect.appendChild(opt);
    itemNoSelect.disabled = false;
    return;
  }

  for (let i = 1; i <= count; i++) {
    const opt = document.createElement("option");
    const key = makeKey(item, String(i));
    const isRented = activeRentedKeys.has(key);

    opt.value = i;
    opt.disabled = isRented;
    opt.textContent = isRented ? `${i}ë²ˆ (ëŒ€ì—¬ì¤‘)` : `${i}ë²ˆ`;
    itemNoSelect.appendChild(opt);
  }

  const firstEnabled = Array.from(itemNoSelect.options).find(o => !o.disabled);
  itemNoSelect.value = firstEnabled ? firstEnabled.value : "";
}

function renderTable() {
  tableBody.innerHTML = "";
  records.sort((a,b)=>a.createdAtMs-b.createdAtMs);

  records.forEach((r, idx) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${r.item}</td>
      <td>${r.itemNo === "âˆ" ? "-" : r.itemNo}</td>
      <td>${r.name}</td>
      <td>${r.studentId}</td>
      <td>${r.rentTime}</td>
      <td>${r.returnTime || ""}</td>
      <td></td>
    `;

    const btn = document.createElement("button");
    btn.textContent = "ë°˜ë‚©";
    btn.disabled = !!r.returnTime;
    btn.onclick = () => returnItem(r.id);
    tr.lastElementChild.appendChild(btn);

    tableBody.appendChild(tr);
  });
}

function refresh() {
  rebuildActive();
  updateItemNoOptions();
  renderTable();
}

// ===== ê¸°ëŠ¥ =====
function rentItem() {
  const item = itemSelect.value;
  const itemNo = itemNoSelect.value;
  const name = nameInput.value.trim();
  const studentId = studentIdInput.value.trim();

  if (!name || !studentId) return alert("ì´ë¦„ê³¼ í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”.");

  if (ITEM_CONFIG[item] !== 0 && activeRentedKeys.has(makeKey(item,itemNo))) {
    return alert("ì´ë¯¸ ëŒ€ì—¬ì¤‘ì…ë‹ˆë‹¤.");
  }

  records.push({
    id: crypto.randomUUID(),
    item,
    itemNo,
    name,
    studentId,
    rentTime: nowKoreanString(),
    returnTime: null,
    createdAtMs: Date.now()
  });

  saveRecords(records);
  nameInput.value="";
  studentIdInput.value="";
  refresh();
}

function returnItem(id) {
  if (prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸") !== ADMIN_PASSWORD) return;

  const r = records.find(x=>x.id===id);
  if (!r || r.returnTime) return;

  r.returnTime = nowKoreanString();
  saveRecords(records);
  refresh();
}

function resetAll() {
  if (prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸") !== ADMIN_PASSWORD) return;
  if (!confirm("ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆë‹¤.")) return;

  records = [];
  localStorage.removeItem(STORAGE_KEY);
  refresh();
}

// ===== ì´ë²¤íŠ¸ =====
document.getElementById("rentBtn").onclick = rentItem;
document.getElementById("resetBtn").onclick = resetAll;
itemSelect.onchange = updateItemNoOptions;
document.getElementById("closeGuideBtn").onclick = () =>
  document.getElementById("guideOverlay").style.display="none";

// ===== ì‹œì‘ =====
initItemSelect();
refresh();
</script>

</body>
</html>
