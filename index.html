<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; background:#ffffff; }
h1 { margin-bottom:10px; }

.notice-box {
  background:#f7f7f7;
  border:1px solid #ddd;
  padding:10px 14px;
  margin-bottom:20px;
  font-size:14px;
  line-height:1.7;
}

.top-area { margin-bottom:15px; }
.form-area { margin-bottom:20px; }

select, input, button {
  padding:6px;
  margin-right:6px;
  font-size:14px;
}

table { width:100%; border-collapse:collapse; }
th, td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
  font-size:14px;
}
th { background:#f2f2f2; }

button { cursor:pointer; }
button:disabled { opacity:0.5; }
.reset-btn { background:#eee; }

.overlay {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.guide-box {
  background:#fff;
  padding:20px;
  width:420px;
  border-radius:6px;
  text-align:center;
}

/* âœ… ì¶”ê°€: íƒ€ì´í‹€ ì˜† ë‚ ì§œ ë¼ë²¨ */
.date-label {
  font-size: 14px;
  color: #888;
  margin-left: 10px;
  font-weight: normal;
}
</style>
</head>
<body>

<!-- ìµœì´ˆ ì ‘ì† ì•ˆë‚´ íŒì—… -->
<div id="guideOverlay" class="overlay">
  <div class="guide-box">
    <p>
      ğŸ“Œ <b>í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€ ì•ˆë‚´</b><br><br>
      1. ë¬¼í’ˆ ì„ íƒ í›„ ì´ë¦„Â·í•™ë²ˆ ì…ë ¥ â†’ <b>[ëŒ€ì—¬í•˜ê¸°]</b><br>
      2. ë°˜ë‚©ì€ <b>í•™ìƒíšŒ ë‹´ë‹¹ì í™•ì¸ í›„</b> ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
      3. ë¬¼í’ˆ ëŒ€ì—¬ëŠ” ìš´ì˜ ì‹œê°„ì¸ <b>10ì‹œ~18ì‹œ</b> ë‚´ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br>
      âœ… <b>ì¼íšŒìš©í’ˆì€ ì¥ë¶€ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.</b>
    </p>
    <button id="closeGuideBtn">í™•ì¸</button>
  </div>
</div>

<!-- âœ… íƒ€ì´í‹€ + ì˜¤ëŠ˜ ë‚ ì§œ -->
<h1>
  í•™ìƒíšŒ ë¬¼í’ˆ ëŒ€ì—¬ ì¥ë¶€
  <span id="todayLabel" class="date-label"></span>
</h1>

<!-- ìƒë‹¨ ê³µì§€ -->
<div class="notice-box">
âœ” ë¬¼í’ˆ ëŒ€ì—¬ëŠ” ìš´ì˜ ì‹œê°„ì¸ <b>10ì‹œ~18ì‹œ</b> ë‚´ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
âœ” ë¬¼í’ˆ ë°˜ë‚© ë˜í•œ <b>ëŒ€ì—¬ ë‹¹ì¼ ìš´ì˜ ì‹œê°„ ë‚´</b>ì— ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br>
âœ” ë°˜ë‚©ì€ <b>í•™ìƒíšŒ ë‹´ë‹¹ìì˜ í™•ì¸</b>ì´ í•„ìš”í•©ë‹ˆë‹¤.
</div>

<div class="top-area">
<button class="reset-btn" id="resetBtn">ì´ˆê¸°í™” (ìƒˆ ì¥ë¶€)</button>
<button id="downloadBtn">ì¥ë¶€ ë‹¤ìš´ë¡œë“œ(.csv)</button>
</div>

<div class="form-area">
<select id="itemSelect"></select>
<select id="itemNoSelect"></select>
<input id="nameInput" placeholder="ì´ë¦„">
<input id="studentInput" placeholder="í•™ë²ˆ">
<button id="rentBtn">ëŒ€ì—¬í•˜ê¸°</button>
</div>

<table>
<thead>
<tr>
<th>ë²ˆí˜¸</th>
<th>ë¬¼í’ˆ</th>
<th>ë¬¼í’ˆë²ˆí˜¸</th>
<th>ì´ë¦„</th>
<th>í•™ë²ˆ</th>
<th>ëŒ€ì—¬ ì‹œê°</th>
<th>ë°˜ë‚© ì‹œê°</th>
<th>ë°˜ë‚©</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const ADMIN_PASSWORD="ì •ì°¬";
const STORAGE_KEY="rental_records_v4";

const ITEM_CONFIG={
  "ì‹¤í—˜ë³µ":15,
  "ê³„ì‚°ê¸°":8,
  "ì»´í“¨í„°ì‚¬ì¸íœ":0,
  "í™”ì´íŠ¸":4,
  "ì":3,
  "í’€":2
};

let records=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
const activeSet=new Set();

function now(){ return new Date().toLocaleString("ko-KR"); }
function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(records)); }

function rebuildActive(){
  activeSet.clear();
  records.forEach(r=>{
    if(!r.returnTime && r.itemNo!=="âˆ"){
      activeSet.add(r.item+"::"+r.itemNo);
    }
  });
}

function initItems(){
  const sel=document.getElementById("itemSelect");
  sel.innerHTML="";
  Object.keys(ITEM_CONFIG).forEach(k=>{
    const o=document.createElement("option");
    o.value=k;
    o.textContent=k;
    sel.appendChild(o);
  });
}

function updateItemNo(){
  const item=document.getElementById("itemSelect").value;
  const count=ITEM_CONFIG[item];
  const sel=document.getElementById("itemNoSelect");
  sel.innerHTML="";

  if(count===0){
    const o=document.createElement("option");
    o.value="âˆ";
    o.textContent="(ëŒ€ì—¬ ê°€ëŠ¥)";
    sel.appendChild(o);
    return;
  }

  for(let i=1;i<=count;i++){
    const o=document.createElement("option");
    o.value=i;
    const key=item+"::"+i;
    if(activeSet.has(key)){
      o.disabled=true;
      o.textContent=i+"ë²ˆ (ëŒ€ì—¬ì¤‘)";
    }else{
      o.textContent=i+"ë²ˆ";
    }
    sel.appendChild(o);
  }

  const first=[...sel.options].find(x=>!x.disabled);
  sel.value=first?first.value:"";
}

function render(){
  rebuildActive();
  updateItemNo();

  const body=document.getElementById("tableBody");
  body.innerHTML="";
  records.sort((a,b)=>a.created-b.created);

  records.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=
      "<td>"+(i+1)+"</td>"+
      "<td>"+r.item+"</td>"+
      "<td>"+(r.itemNo==="âˆ"?"-":r.itemNo)+"</td>"+
      "<td>"+r.name+"</td>"+
      "<td>"+r.student+"</td>"+
      "<td>"+r.rentTime+"</td>"+
      "<td>"+(r.returnTime||"")+"</td>"+
      "<td></td>";

    const btn=document.createElement("button");
    btn.textContent="ë°˜ë‚©";
    btn.disabled=!!r.returnTime;
    btn.onclick=()=>returnItem(r.id);
    tr.lastChild.appendChild(btn);

    body.appendChild(tr);
  });
}

function rent(){
  const item=document.getElementById("itemSelect").value;
  const no=document.getElementById("itemNoSelect").value;
  const name=document.getElementById("nameInput").value.trim();
  const student=document.getElementById("studentInput").value.trim();

  if(!name||!student){
    alert("ì´ë¦„ê³¼ í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  if(no!=="âˆ"){
    const key=item+"::"+no;
    if(activeSet.has(key)){
      alert("ì´ë¯¸ ëŒ€ì—¬ì¤‘ì…ë‹ˆë‹¤.");
      return;
    }
  }

  records.push({
    id:crypto.randomUUID(),
    item:item,
    itemNo:no,
    name:name,
    student:student,
    rentTime:now(),
    returnTime:null,
    created:Date.now()
  });

  save();
  document.getElementById("nameInput").value="";
  document.getElementById("studentInput").value="";
  render();
}

function returnItem(id){
  if(prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸")!==ADMIN_PASSWORD){
    alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    return;
  }
  const r=records.find(x=>x.id===id);
  if(!r||r.returnTime) return;
  r.returnTime=now();
  save();
  render();
}

function downloadCSV(){
  if(records.length===0){
    alert("ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  let csv="ë²ˆí˜¸,ë¬¼í’ˆ,ë¬¼í’ˆë²ˆí˜¸,ì´ë¦„,í•™ë²ˆ,ëŒ€ì—¬ì‹œê°,ë°˜ë‚©ì‹œê°\n";
  records.forEach((r,i)=>{
    csv+=(i+1)+","+r.item+","+(r.itemNo==="âˆ"?"-":r.itemNo)+","+r.name+","+r.student+","+r.rentTime+","+(r.returnTime||"")+"\n";
  });

  const blob=new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="í•™ìƒíšŒ_ë¬¼í’ˆëŒ€ì—¬ì¥ë¶€.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function resetAll(){
  if(prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸")!==ADMIN_PASSWORD){
    alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    return;
  }

  const saved=confirm("ì´ˆê¸°í™” ì „ì— ê¸°ì¡´ ì¥ë¶€ë¥¼ ì €ì¥í–ˆë‚˜ìš”?");
  if(!saved){
    alert("ë¨¼ì € ê¸°ì¡´ ì¥ë¶€ ë‹¤ìš´ë¡œë“œë¥¼ ì§„í–‰í•˜ì„¸ìš”.");
    return;
  }

  if(!confirm("ì •ë§ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆê¹Œ?")) return;

  records=[];
  localStorage.removeItem(STORAGE_KEY);
  render();
}

/* âœ… ì¶”ê°€: ì˜¤ëŠ˜ ë‚ ì§œ ë¼ë²¨ ì„¸íŒ… */
function setTodayLabel(){
  const d=new Date();
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,"0");
  const day=String(d.getDate()).padStart(2,"0");
  const el=document.getElementById("todayLabel");
  if(el) el.textContent=`(${y}.${m}.${day} ê¸°ì¤€)`;
}

document.getElementById("rentBtn").onclick=rent;
document.getElementById("resetBtn").onclick=resetAll;
document.getElementById("downloadBtn").onclick=downloadCSV;
document.getElementById("itemSelect").onchange=updateItemNo;
document.getElementById("closeGuideBtn").onclick=()=>{document.getElementById("guideOverlay").style.display="none";};

initItems();
setTodayLabel();
render();
</script>

</body>
</html>
